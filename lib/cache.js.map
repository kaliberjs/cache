{"version":3,"file":"cache.js","names":["createCache","allowReturnExpiredValue","expirationTime","cache","getCachedValue","cacheKey","getValue","now","Date","safeCacheKey","JSON","stringify","cachedItem","isValid","validUntil","value","callbackValue","newCacheItem","hasCatchProperty","catch","x","Boolean"],"sources":["../src/cache.js"],"sourcesContent":["/**\n * @param {import('./types').CacheParams} params\n */\nexport function createCache({ allowReturnExpiredValue, expirationTime }) {\n  const cache = {}\n\n  /**\n   * @template T\n   * @type {import('./types').Cache<T>}\n   */\n  return function getCachedValue({ cacheKey, getValue }) {\n    const now = Date.now()\n    const safeCacheKey = JSON.stringify(cacheKey)\n    const cachedItem = cache[safeCacheKey]\n\n    const isValid = cachedItem && cachedItem.validUntil >= now\n    if (isValid) return cachedItem.value\n\n    const callbackValue = getValue()\n\n    const newCacheItem = { value: callbackValue, validUntil: now + expirationTime }\n    cache[safeCacheKey] = newCacheItem\n\n    if (hasCatchProperty(callbackValue)) callbackValue.catch(() => {\n      if (cache[safeCacheKey] !== newCacheItem) return\n      cache[safeCacheKey] = cachedItem\n    })\n\n    return (cachedItem && allowReturnExpiredValue) ? cachedItem.value : newCacheItem.value\n  }\n}\n\n/** @returns {x is { catch(f: (e: any) => void): any }} */\nfunction hasCatchProperty(x) {\n  return Boolean(x && x.catch)\n}\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACO,SAASA,WAAT,OAAkE;EAAA,IAA3CC,uBAA2C,QAA3CA,uBAA2C;EAAA,IAAlBC,cAAkB,QAAlBA,cAAkB;EACvE,IAAMC,KAAK,GAAG,EAAd;EAEA;AACF;AACA;AACA;;EACE,OAAO,SAASC,cAAT,QAAgD;IAAA,IAAtBC,QAAsB,SAAtBA,QAAsB;IAAA,IAAZC,QAAY,SAAZA,QAAY;IACrD,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;IACA,IAAME,YAAY,GAAGC,IAAI,CAACC,SAAL,CAAeN,QAAf,CAArB;IACA,IAAMO,UAAU,GAAGT,KAAK,CAACM,YAAD,CAAxB;IAEA,IAAMI,OAAO,GAAGD,UAAU,IAAIA,UAAU,CAACE,UAAX,IAAyBP,GAAvD;IACA,IAAIM,OAAJ,EAAa,OAAOD,UAAU,CAACG,KAAlB;IAEb,IAAMC,aAAa,GAAGV,QAAQ,EAA9B;IAEA,IAAMW,YAAY,GAAG;MAAEF,KAAK,EAAEC,aAAT;MAAwBF,UAAU,EAAEP,GAAG,GAAGL;IAA1C,CAArB;IACAC,KAAK,CAACM,YAAD,CAAL,GAAsBQ,YAAtB;IAEA,IAAIC,gBAAgB,CAACF,aAAD,CAApB,EAAqCA,aAAa,CAACG,KAAd,CAAoB,MAAM;MAC7D,IAAIhB,KAAK,CAACM,YAAD,CAAL,KAAwBQ,YAA5B,EAA0C;MAC1Cd,KAAK,CAACM,YAAD,CAAL,GAAsBG,UAAtB;IACD,CAHoC;IAKrC,OAAQA,UAAU,IAAIX,uBAAf,GAA0CW,UAAU,CAACG,KAArD,GAA6DE,YAAY,CAACF,KAAjF;EACD,CAnBD;AAoBD;AAED;;;AACA,SAASG,gBAAT,CAA0BE,CAA1B,EAA6B;EAC3B,OAAOC,OAAO,CAACD,CAAC,IAAIA,CAAC,CAACD,KAAR,CAAd;AACD"}